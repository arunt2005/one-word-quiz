<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GK Exam - Practice</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    /* [Unchanged styling from previous version] */
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1>GK Exam - Practice</h1>
    <input type="file" id="fileInput" accept=".xlsx,.xls" />
    <div id="progressContainer">
      <div id="progressBar"></div>
    </div>
    <h2 id="question">Loading...</h2>
    <div id="options"></div>
    <div id="navigation">
      <button id="prevBtn">Previous</button>
      <button id="nextBtn">Next</button>
      <button id="submitBtn">Submit</button>
    </div>
    <button id="restartBtn">Restart</button>
    <div id="finalScore"></div>
    <div id="summary"></div>
  </div>

  <script>
    let currentQuestion = 0;
    let score = 0;
    let quizData = [];
    let userAnswers = [];

    document.getElementById("fileInput").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: "array" });
          const sheet = workbook.Sheets[workbook.SheetNames[0]];
          const parsedData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
          quizData = parsedData.slice(1).map(row => ({
            question: row[0],
            options: row.slice(1, 5),
            answer: row[5]
          }));
          userAnswers = new Array(quizData.length).fill(null);
          showQuestion();
        };
        reader.readAsArrayBuffer(file);
      }
    });

    function showQuestion() {
      const questionElement = document.getElementById("question");
      const optionsElement = document.getElementById("options");
      const progressBar = document.getElementById("progressBar");
      const q = quizData[currentQuestion];

      questionElement.textContent = q.question;
      optionsElement.innerHTML = "";

      q.options.forEach((option, index) => {
        const div = document.createElement("div");
        div.className = "option";
        div.textContent = option;
        div.onclick = () => {
          userAnswers[currentQuestion] = option;
          showQuestion();
        };
        if (userAnswers[currentQuestion] === option) {
          div.classList.add("selected");
        }
        optionsElement.appendChild(div);
      });

      progressBar.style.width = `${((currentQuestion + 1) / quizData.length) * 100}%`;
    }

    document.getElementById("prevBtn").onclick = () => {
      if (currentQuestion > 0) {
        currentQuestion--;
        showQuestion();
      }
    };

    document.getElementById("nextBtn").onclick = () => {
      if (currentQuestion < quizData.length - 1) {
        currentQuestion++;
        showQuestion();
      }
    };

    document.getElementById("submitBtn").onclick = () => {
      score = 0;
      const summary = document.getElementById("summary");
      summary.innerHTML = "";

      quizData.forEach((q, i) => {
        const isCorrect = userAnswers[i] === q.answer;
        if (isCorrect) score++;

        const p = document.createElement("p");
        p.innerHTML = `<strong>Q${i + 1}: ${q.question}</strong><br>
                       Your answer: ${userAnswers[i] || "No answer"}<br>
                       Correct answer: ${q.answer}<br>
                       <span style='color: ${isCorrect ? "green" : "red"};'>${isCorrect ? "Correct" : "Wrong"}</span>`;
        summary.appendChild(p);
      });

      document.getElementById("finalScore").textContent = `Your final score is ${score}/${quizData.length}`;
    };

    document.getElementById("restartBtn").onclick = () => {
      currentQuestion = 0;
      score = 0;
      userAnswers = new Array(quizData.length).fill(null);
      document.getElementById("summary").innerHTML = "";
      document.getElementById("finalScore").textContent = "";
      showQuestion();
    };
  </script>
</body>
</html>
